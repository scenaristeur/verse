"use strict";(self["webpackChunkverse"]=self["webpackChunkverse"]||[]).push([[922],{9021:function(e,t,n){n.r(t),n.d(t,{default:function(){return d}});var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-button",{staticClass:"m-3",attrs:{variant:"success"},on:{click:function(t){e.node["ve:type"]=void 0==e.node["ve:type"]||"html"==e.node["ve:type"]?"node":"html"}}},[e._v(" "+e._s("node"==e.node["ve:type"]?"Switch to Html Edition":"Switch to Node Edition")+" ")]),"node"==e.node["ve:type"]?n("b-container",[n("b-row",[n("b-col",{attrs:{sm:"3"}},[n("label",{attrs:{for:"name"}},[e._v("Name:")])]),n("b-col",{attrs:{sm:"9"}},[n("b-form-input",{attrs:{id:"name",autocomplete:"off",autofocus:""},model:{value:e.node["ve:name"],callback:function(t){e.$set(e.node,"ve:name",t)},expression:"node['ve:name']"}})],1),n("b-col",{attrs:{sm:"3"}},[n("label",{attrs:{for:"age"}},[n("code",[e._v("Age")]),e._v(":")])]),n("b-col",[n("b-form-input",{attrs:{id:"age",required:"",type:"number"},model:{value:e.node["ve:age"],callback:function(t){e.$set(e.node,"ve:age",t)},expression:"node['ve:age']"}})],1)],1),e._l(e.node["ve:properties"],(function(t){return n("b-row",{key:t.name},[n("b-col",{attrs:{sm:"3"}},[n("label",{attrs:{for:"name"}},[n("code",[e._v(e._s(t.name))]),e._v(":")])]),n("b-col",{attrs:{sm:"9"}},[n("b-button",{attrs:{variant:"outline-primary"},on:{click:function(n){return e.showFieldModal(t)}}},[e._v("+")]),n("ValuesComponent",{attrs:{values:t.values}})],1)],1)})),null!=e.field?n("b-row",{staticClass:"mt-3"},[n("b-col",{attrs:{sm:"3"}},[n("b-form-input",{attrs:{required:"",placeholder:"property name"},on:{change:e.fieldNameChanged},model:{value:e.field.name,callback:function(t){e.$set(e.field,"name",t)},expression:"field.name"}})],1),n("b-col",{attrs:{sm:"9"}},[n("b-button",{attrs:{variant:"outline-secondary",size:"sm"},on:{click:e.clear_field}},[e._v("X")])],1)],1):e._e(),n("b-row",[n("b-col"),n("b-col",[n("b-btn",{attrs:{variant:"outline-primary",size:"sm"},on:{click:e.add}},[e._v("+ add a property or a link")])],1)],1),n("b-row",[n("b-col",[n("b-btn",{attrs:{variant:"success"},on:{click:e.save}},[e._v("Save Node")]),n("PermissionsLayout",{attrs:{permissions:e.permissions,url:e.node["ve:url"],autorized:e.autorized}})],1)],1),n("b-modal",{attrs:{id:"fieldModal",size:"xl",title:e.node["ve:name"]+" -> "+e.currentProp.name}},[n("b-tabs",{attrs:{"content-class":"mt-3"}},[n("b-tab",{attrs:{title:"text",active:""},on:{click:function(t){e.fieldType="text"}}},[n("b-form-input",{attrs:{placeholder:"new value"},on:{change:e.addNewValue},model:{value:e.newvalue,callback:function(t){e.newvalue=t},expression:"newvalue"}})],1),n("b-tab",{attrs:{title:"textarea"},on:{click:function(t){e.fieldType="textarea"}}},[n("b-form-textarea",{attrs:{placeholder:"Enter something...",rows:"3","max-rows":"6"},on:{change:e.addNewValue},model:{value:e.newvalue,callback:function(t){e.newvalue=t},expression:"newvalue"}})],1),n("b-tab",{attrs:{title:"node"},on:{click:function(t){e.fieldType="node"}}},[n("NodeSelector",{attrs:{currentProp:e.currentProp},on:{"update:currentProp":function(t){e.currentProp=t},"update:current-prop":function(t){e.currentProp=t}}})],1),n("b-tab",{attrs:{title:"link"},on:{click:function(t){e.fieldType="link"}}},[n("b-form-input",{attrs:{placeholder:"name"},model:{value:e.link.name,callback:function(t){e.$set(e.link,"name",t)},expression:"link.name"}}),n("b-form-input",{attrs:{placeholder:"link"},on:{change:e.addNewLink},model:{value:e.link.href,callback:function(t){e.$set(e.link,"href",t)},expression:"link.href"}})],1)],1)],1)],2):n("b-container",[n("CKWysiwyg")],1)],1)},o=[],i={name:"EditView",components:{NodeSelector:()=>n.e(191).then(n.bind(n,9191)),ValuesComponent:()=>n.e(315).then(n.bind(n,6315)),PermissionsLayout:()=>n.e(417).then(n.bind(n,3417)),CKWysiwyg:()=>n.e(15).then(n.bind(n,1015))},data(){return{node:null,field:null,clearing:!1,fieldType:"text",show:!1,currentProp:{},newvalue:null,link:{},permissions:null}},async created(){this.node=this.$store.state.nodes.currentNode||{"@context":{"@vocab":"https://www.w3.org/ns/activitystreams#",ve:"https://scenaristeur.github.io/verse#",id:"@id",type:"@type"},"ve:name":"","ve:age":0,"ve:privacy":"private","ve:type":"node","ve:properties":[],test:"test vocab"},console.log("--- hack temporaire du type",this.node["ve:type"]),"html"!=this.node["ve:type"]&&(this.node["ve:type"]="node"),await this.getPermissions()},methods:{async save(){await this.$store.dispatch("nodes/saveNode",this.node),this.$store.commit("nodes/setCurrentNode",null),this.$router.push("/")},add(){this.field={name:""}},fieldNameChanged(e){if(console.log(e),0==this.clearing){let n={name:e,values:[]};void 0==this.node["ve:properties"]&&(this.node["ve:properties"]=[]);var t=this.node["ve:properties"].findIndex((e=>e.name==n.name));-1===t?this.node["ve:properties"].push(n):alert(n.name+" already exist")}},clear_field(){this.clearing=!0,this.field=null,this.clearing=!1},showFieldModal(e){console.log(e),this.fieldType="text",this.currentProp=e,this.$bvModal.show("fieldModal")},addNewValue(){let e={value:this.newvalue,type:this.fieldType};this.currentProp.values.push(e),this.newvalue=null},addNewLink(){let e={value:this.link,type:this.fieldType};this.currentProp.values.push(e),this.link={}},async getPermissions(){this.permissions=void 0!=this.node["ve:url"]?await this.$getPermissions(this.node):null,console.log("PERMISSIONS",this.permissions)}},watch:{currentNode(){console.log("CURRENT NODE Changed"),this.getPermissions()}},computed:{currentNode(){return this.$store.state.nodes.currentNode},autorized(){return null!=this.permissions&&(1==this.permissions.user.append||1==this.permissions.user.write||1==this.permissions.public.append||1==this.permissions.public.write)}}},a=i,r=n(1001),l=(0,r.Z)(a,s,o,!1,null,null,null),d=l.exports}}]);
//# sourceMappingURL=edit.8d747e5d.js.map